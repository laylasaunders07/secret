<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Google Sheets Guestbook</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 2em; max-width: 600px; }
    input, textarea { width: 100%; padding: 0.6em; margin: 0.5em 0; border-radius: 6px; border: 1px solid #ccc; }
    button { padding: 0.6em 1.2em; border: none; border-radius: 6px; background: #1976d2; color: white; cursor: pointer; }
    button:disabled { background: #90caf9; cursor: not-allowed; }
    .message { background: #f5f5f5; padding: 0.6em; margin: 0.5em 0; border-radius: 6px; }
    .loading { display: none; color: #1976d2; font-weight: bold; }
  </style>
</head>
<body>
  <h1>ðŸ’¬ Guestbook (Google Sheets)</h1>

  <form id="form">
    <input id="name" placeholder="Your name" required />
    <textarea id="message" placeholder="Your message..." required></textarea>
    <button type="submit">Send</button>
    <span id="loading" class="loading">Sending...</span>
  </form>

  <h2>Messages</h2>
  <div id="messages"></div>

  <script>
    // --- CONFIGURATION ---
    const API_URL = "https://script.google.com/macros/s/AKfycbxJMs8GyeIRIAF-NIGuq8uo7n-pZ9c91SpoCEJyOKzFaKWTdBWp5voT83IshGMNS7qu/exec";   // Replace with your Apps Script web app URL
    const SECRET_KEY = "alva-the-fortnite-god";    // Must match the key in Apps Script

    // --- UTILITIES ---

    // Load and display all messages
    async function loadMessages() {
      const res = await fetch(API_URL);
      const data = await res.json();
      const container = document.getElementById("messages");
      container.innerHTML = "";

      // Show newest first
      data.reverse().forEach(msg => {
        const div = document.createElement("div");
        div.className = "message";
        div.innerHTML = `<strong>${msg.name}</strong>: ${msg.message}<br>
                         <small>${msg.timestamp}</small>`;
        container.appendChild(div);
      });
    }

    // --- FORM HANDLER ---
    const form = document.getElementById("form");
    const loading = document.getElementById("loading");
    const button = form.querySelector("button");

    form.addEventListener("submit", async e => {
      e.preventDefault();

      // Disable while sending + show loading text
      button.disabled = true;
      loading.style.display = "inline";

      const name = document.getElementById("name").value.trim();
      const message = document.getElementById("message").value.trim();

      // Send to Google Apps Script
      await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, message, key: SECRET_KEY })
      });

      // Reset form + UI
      form.reset();
      button.disabled = false;
      loading.style.display = "none";

      // Refresh message list
      loadMessages();
    });

    // Load messages on page load
    loadMessages();
  </script>
</body>
</html>
