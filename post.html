<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Post</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    .post { margin-bottom: 40px; }
    .comment { border-top: 1px solid #ccc; padding: 10px 0; }
    .timestamp { font-size: 0.8em; color: #777; }
  </style>
</head>
<body>
  <a id="backLink" href="#">‚Üê Back</a>
    <script>
      // Determine the referrer from the query string
      const URLparams = new URLSearchParams(window.location.search);
      const from = URLparams.get("from") || "index.html";
      document.getElementById("backLink").href = from;
    </script>

  <div id="post"></div>
  <h3>Comments</h3>
  <div id="comments"></div>

  <script>
  const API_URL = "https://gentle-wind-dea4.silly-7f7.workers.dev";
  const urlParams = new URLSearchParams(window.location.search);
  const postId = urlParams.get("id");

  async function loadPost() {
    const res = await fetch(`${API_URL}?type=post&id=${postId}`);
    const data = await res.json();

    if (!data || data.error) {
      document.body.innerHTML = "<p>Post not found.</p>";
      return;
    }

    const p = data.post;
    const c = data.comments;

    // --- Render main post ---
    const postDiv = document.getElementById("post");
    postDiv.innerHTML = `
      <div class="post" style="margin-bottom: 40px;">
        <div class="post-header" style="cursor: default;">
          <strong>${p.name || "Unknown User"}</strong>
          <a href="user.html?id=${p.userId}" style="color: #007bff; text-decoration: none;">
            @${p.username}
          </a>
        </div>
        <div class="post-message" style="cursor: default;">${p.message}</div>
        <small style="color: gray;">${new Date(p.timestamp).toLocaleString()}</small>
      </div>
    `;

    // --- Render comments ---
    const commentsDiv = document.getElementById("comments");
    if (!c || c.length === 0) {
      commentsDiv.innerHTML = "<em>No comments yet.</em>";
      return;
    }

    commentsDiv.innerHTML = c.map(cm => `
      <div class="comment" style="border-top: 1px solid #ddd; padding: 10px 0;">
        <div class="post-header" style="cursor: default;">
          <strong>${cm.name || "Unknown User"}</strong>
          <a href="user.html?id=${cm.userId}" style="color: #007bff; text-decoration: none;">
            @${cm.username}
          </a>
        </div>
        <div class="post-message" style="cursor: default;">${cm.comment}</div>
        <small style="color: gray;">${new Date(cm.timestamp).toLocaleString()}</small>
      </div>
    `).join("");
  }

  loadPost();
</script>
</body>
</html>
